<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Create Post</title>
</head>

<body>
    <h1>Create Post</h1>
    <form action="/publicationSubmitForm" method="post" enctype="multipart/form-data">
        <!-- Title -->
        <label for="title">Title:</label>
        <br>
        <input type="text" id="title" name="title" value="{{.Title}}" required>
        <br><br>

        <!-- Description -->
        <label for="content">Content:</label>
        <br>
        <textarea id="content" name="content" rows="4" cols="50" required>{{.Content}}</textarea>
        <br><br>

        <!-- Image -->
        <label for="image">Image:</label>
        <br>
        <input type="file" id="image" name="image" onchange="displayImage()" value="{{.ImageLink}}">
        <br><br>
        <img id="image-preview" src="../testcrud/uploads/{{.ImageLink}}" alt="Image">
        <br><br>

        <style>
            img {
                width: 400px;
                height: 400px;
                object-fit: contain;
            }
        </style>

        <script>
        function displayImage() {
            const file = document.getElementById('image').files[0];
            const imagePreview = document.getElementById('image-preview');

            if (!file.type.startsWith('image/')) {
                alert('Please select an image file');
                document.getElementById('image').value = '';
            } else {
                const reader = new FileReader();
                reader.onload = function() {
                    imagePreview.src = reader.result;
                }
                reader.readAsDataURL(file);

                imagePreview.style.display = 'block';
            }
        }
        </script>

        <!-- Tags -->
        <label for="tags">Tags:</label>
        <br>
        <select id="tags" name="tags">
            <option value="Nature">Nature</option>
            <option value="Space">Space</option>
        </select>
        <button type="button" onclick="addTag()">Add Tag</button>
        <br><br>

        <!-- List of tags -->
        <label for="selected-tags">Selected Tags:</label>
        <br>
        <ul id="selected-tags"></ul>
        <input type="hidden" id="selected-tags-input" name="selected-tags" value="">
        <br>

        <!-- Submit -->
        <input type="submit" value="Create Post">
    </form>

    <!-- Script to add tags -->
    <script>
        function addTag() {
            var select = document.getElementById("tags");
            var selectedOption = select.options[select.selectedIndex];
            var selectedTag = selectedOption.value;
            var selectedTagsList = document.getElementById("selected-tags");
            var selectedTagsInput = document.getElementById("selected-tags-input");
            
            if (!Array.from(selectedTagsList.getElementsByTagName("li")).map(li => li.innerText).includes(selectedTag)) {
                var newTag = document.createElement("li");
                newTag.innerText = selectedTag;
                selectedTagsList.appendChild(newTag);
                var selectedTags = Array.from(selectedTagsList.getElementsByTagName("li")).map(li => li.innerText);
                selectedTagsInput.value = JSON.stringify(selectedTags);
            }
        }
    </script>
</body>

</html>